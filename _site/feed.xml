<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

	<title>LAMFO's Blog</title>
	<link href="/blog/atom.xml" rel="self"/>
	<link href="/blog"/>
	<updated>2017-06-04T00:09:57-03:00</updated>
	<id>http://lamfo-unb.github.io/blog</id>
	<author>
		<name>LAMFO</name>
		<email>lamfo/(at)unb/(dot)br</email>
	</author>

	
		<entry>
			<title>Vizualization and exploration of Spatial data in R</title>
			<link href="http://lamfo-unb.github.io/2017/06/03/Vizualization-and-exploration-of-Spatial-data-in-R/"/>
			<updated>2017-06-03T13:25:15-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/06/03/Vizualization-and-exploration-of-Spatial-data-in-R</id>
			<content type="html">&lt;h1 id=&quot;vizualization-and-exploration-of-spatial-data-in-r&quot;&gt;&lt;strong&gt;&lt;em&gt;Vizualization and exploration of Spatial data in R&lt;/em&gt;&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;In this post we will base ourselves on the tutorial by Robin Lovelace et. Al. (2017) and the material that will be used is available &lt;a href=&quot;https://github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;here&lt;/a&gt; in the &lt;em&gt;Creating-maps-in-R.Rproj&lt;/em&gt; project.&lt;/p&gt;

&lt;p&gt;Initially, you need to install the following packages in the R:
&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;ggplot2&quot;, &quot;ggmap&quot;,&quot;rgdal&quot;,&quot;rgeos&quot;,&quot;maptools&quot;,&quot;dplyr&quot;,&quot;tidyr&quot;,&quot;tmap&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The next step is to open the shape file. The shapefile is a file format that stores geospatial data, such as position, shape, and attributes, in a vector form. In RStudio you can open this type of file as follows:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;london_sport&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The last line of the code shows that the variable class &lt;em&gt;Pop_2001&lt;/em&gt; is classified as a factor, whereas it should be numeric. We must change it for this analysis:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pop_2001&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.numeric&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pop_2001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;A first analysis can be made selecting the regions that have a certain index of participation in the sport:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;turquoise&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-3-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Another interesting analysis is the identification of quadrants. This division can be made based on the coordinates of the centroid, which in this case represents the central point of London.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgeos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## encontrando o centro da regi√£o de londres
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gCentroid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))[[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gCentroid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))[[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## argumento para testar se a regi√£o est√° ao norte ou ao leste do centro
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## testando se a coordenada est√° a norte ou leste do centro
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;nordeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;noroeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sudeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sudoeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## colorindo os quadrantes no gr√°fico
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as.factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;yellow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-4-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;creating-maps-whith-tmap-ggplot-and-leaflet&quot;&gt;Creating maps whith tmap, ggplot and leaflet&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Tmap&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The analysis can be done by generating a color gradient based on the percentage participation of the population in the sport:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;qtm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Partic_Per&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill.palette&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-Blues&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-5-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ggplot2&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Unlike tmap, ggplot requires you to provide the database in data.frame format. This can be done through the &lt;code class=&quot;highlighter-rouge&quot;&gt;fortify()&lt;/code&gt; function:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dplyr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fortify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row.names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Atribui um ID para a base sp 
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# ultima checagem antes da jun√ß√£o (os nomes das vari√°veis precisam ser iguais)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;left_join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# juntou pela √∫nica vari√°vel com nome em comum
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now the lnd_f object can be used to create a map with ggplot:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Easting (m)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Northing (m)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;% Sports\nParticipation&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggtitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;London Sports Participation&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## trocando as cores
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_fill_gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;low&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;high&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## salvando o grafico com ggsave
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggsave&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Sport Participation - London.jpg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/img_ggplot2.jpg&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;interactive-maps-with-leaflet&quot;&gt;&lt;strong&gt;Interactive maps with leaflet&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;The leaflet package allows the creation of interactive maps and acts together with the shiny package, making the online visualization possible. The lnd object is with a Coordinate Reference System (CRS) that is not compatible with the leaflet. The display will be possible after the CRS of the lnd object is changed to the EPSG: 4326, which has been the most used one:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd84&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spTransform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#reprojeta
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolygons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd84&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;iframe title=&quot;London Map&quot; width=&quot;700&quot; height=&quot;400&quot; src=&quot;https://cdn.rawgit.com/jadermcs/fdb08a2c254288844c6ae4673e4e6e0b/raw/a92f7fdf0ec510d30504c934b3dcecbe8ab67fd3/london_map.html&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;This map differs from the others because it allows a similar expirience to the use of googlemaps in the browser.&lt;/p&gt;

&lt;p&gt;Next we have another example of visualization in the leaflet, but now we will use the shapefile of the Federal District, available on the IBGE website. After you download the file and sabe it to your current Working Directory, the first step is to assign the file to a new object, here called &lt;em&gt;df_shp&lt;/em&gt;:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;df_setores_censitarios&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;53SEE250GC_SIR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Cria√ß√£o do mapa com leaflet
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proj4string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# reprojeta
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_leaf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolygons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stroke&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#03F&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addLegend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bottomright&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;colors&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#03F&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Distrito Federal&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_leaf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The code above follows the same reasoning of the created for the map of London, but with some more configurations. The .shp file was inserted directly into the leaflet function and the addPolygons function included the fill, weight, stroke and color arguments, which respectively represent whether the interior of the polygons should receive some color, the thickness of the contour line, if the lines of the Polygons should be colored and which color should be chosen. The addLegend function creates a legend for the map. For more details on functions, simply run the following command:?Function-name.&lt;/p&gt;

&lt;iframe title=&quot;London Map&quot; width=&quot;700&quot; height=&quot;400&quot; src=&quot;https://cdn.rawgit.com/jadermcs/9f68419b0b05e32b8741861e80c7df02/raw/b1d9d0394fdd4f724dbc591a14dfa0537baca45e/df.html&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
</content>
		</entry>
	
		<entry>
			<title>Visualiza√ß√£o e explora√ß√£o de dados espaciais em R</title>
			<link href="http://lamfo-unb.github.io/2017/06/03/Visualizacao-e-exploracao-de-dados-espaciais-em-R/"/>
			<updated>2017-06-03T10:55:44-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/06/03/Visualizacao-e-exploracao-de-dados-espaciais-em-R</id>
			<content type="html">&lt;h1 id=&quot;visualiza√ß√£o-e-explora√ß√£o-de-dados-espaciais-no-r&quot;&gt;&lt;strong&gt;&lt;em&gt;Visualiza√ß√£o e explora√ß√£o de dados espaciais no R&lt;/em&gt;&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Neste post iremos nos basear no tutorial de Robin Lovelace et. al. (2017) e o material que ser√° utilizado est√° dispon√≠vel em seu &lt;a href=&quot;https://www.github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;repositorio&lt;/a&gt; no Github, no projeto &lt;em&gt;Creating-maps-in-R.Rproj&lt;/em&gt;. 
Inicialmente, √© preciso instalar os seguintes pacotes no R: 
&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;ggplot2&quot;, &quot;ggmap&quot;,&quot;rgdal&quot;,&quot;rgeos&quot;,&quot;maptools&quot;,&quot;dplyr&quot;,&quot;tidyr&quot;,&quot;tmap&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Feita a instala√ß√£o dos pacotes necess√°rios, o primeiro passo √© abrir a shape file. Aqui iremos nos basear no tutorial de Robin Lovelace et. al. (2017) e o material que ser√° utilizado est√° dispon√≠vel no &lt;a href=&quot;https://www.github.com/Robinlovelace/Creating-maps-in-R&quot;&gt;link&lt;/a&gt; no projeto &lt;em&gt;Creating-maps-in-R.Rproj&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;O shapefile √© um formato de arquivo que armazena dados geoespaciais, como posi√ß√£o, forma e atributos, em forma de vetor. No RStudio a abertura desse tipo de arquivo pode ser feita da seguinte forma:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgdal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;london_sport&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;A √∫ltima linha do c√≥digo mostra que a classe da vari√°vel &lt;em&gt;Pop_2001&lt;/em&gt; est√° classificada como fator, enquanto deveria ser do tipo num√©rico. Portanto, devemos alter√°-la:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pop_2001&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.numeric&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pop_2001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Uma primeira an√°lise pode ser feita com apenas selecionando as regi√µes que possuam determinado √≠ndice de participa√ß√£o no esporte:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;turquoise&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-3-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Outra an√°lise interessante √© a identifica√ß√£o de quadrantes. Essa divis√£o pode ser feita tendo como base as coordenadas do centroide, que no caso representa o ponto central de Londres.&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rgeos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## encontrando o centro da regi√£o de londres
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gCentroid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))[[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gCentroid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))[[&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## argumento para testar se a regi√£o est√° ao norte ou ao leste do centro
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coordinates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[,&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lng&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## testando se a coordenada est√° a norte ou leste do centro
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;nordeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;noroeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sudeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;sudoeste&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## colorindo os quadrantes no gr√°fico
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as.factor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as.character&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;quadrant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sapply&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;lightgrey&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;norte&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sul&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;oeste&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;yellow&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-4-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;criando-mapas-com-tmap-ggplot-e-leaflet&quot;&gt;Criando mapas com tmap, ggplot e leaflet&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Tmap&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;A an√°lise pode ser feita gerando um gradiente de cores com base na participa√ß√£o percentual da popula√ß√£o no esporte:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;qtm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Partic_Per&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill.palette&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-Blues&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/chunk-5-1.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ggplot2&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Diferentemente do tmap, o ggplot exige que voc√™ forne√ßa a base de dados em formado de data.frame. Isto pode ser feito por meio da fun√ß√£o fortify():&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dplyr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fortify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;row.names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Atribui um ID para a base sp 
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# ultima checagem antes da jun√ß√£o (os nomes das vari√°veis precisam ser iguais)
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;left_join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# juntou pela √∫nica vari√°vel com nome em comum
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Agora o objeto lnd_f pode ser utilizado para a cria√ß√£o de um mapa com ggplot:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd_f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;aes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Partic_Per&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;geom_polygon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coord_equal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Easting (m)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Northing (m)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;% Sports\nParticipation&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggtitle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;London Sports Participation&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## trocando as cores
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scale_fill_gradient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;low&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;red&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;high&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;green&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;## salvando o grafico com ggsave
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ggsave&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Sport Participation - London.jpg&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/img/geospace/img_ggplot2.jpg&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Mapas interativos com leaflet&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;O pacote leaflet permite a cria√ß√£o de mapas interativos e age de forma conjunta com o pacote shiny, tornando poss√≠vel a visualiza√ß√£o online dos mapas. O objeto lnd est√° com um CRS (Coordinate Reference System) que n√£o √© compat√≠vel com o leaflet. A visualiza√ß√£o ser√° poss√≠vel depois que o CRS do objeto lnd for alterado para o EPSG:4326, que tem sido o mais utilizado:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd84&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;spTransform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#reprojeta
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolygons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lnd84&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;iframe title=&quot;London Map&quot; width=&quot;700&quot; height=&quot;400&quot; src=&quot;https://cdn.rawgit.com/jadermcs/fdb08a2c254288844c6ae4673e4e6e0b/raw/a92f7fdf0ec510d30504c934b3dcecbe8ab67fd3/london_map.html&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;Esse mapa se diferencia dos outros por permitir uma interatividade semelhante √† que se tem com a utiliza√ß√£o do googlemaps no navegador.&lt;/p&gt;

&lt;p&gt;A seguir temos mais um exemplo de visualiza√ß√£o de uma determinada regi√£o no leaflet, por√©m agora ser√° utilizado o arquivo shapefile do Distrito Federal, dispon√≠vel no site do IBGE. Depois de baixar o arquivo e salv√°-lo no seu Working Directory atual,  o primeiro passo √© atribuir o arquivo √† um novo objeto, aqui denominado &lt;em&gt;df_shp&lt;/em&gt;:&lt;/p&gt;

&lt;div class=&quot;language-r highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raster&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;library&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readOGR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;df_setores_censitarios&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;layer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;53SEE250GC_SIR&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Cria√ß√£o do mapa com leaflet
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;proj4string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CRS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;+init=epsg:4326&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# reprojeta
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_leaf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;leaflet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_shp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addTiles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addPolygons&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fill&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;FALSE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;weight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stroke&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;TRUE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#03F&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&amp;gt;%&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addLegend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;bottomright&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;colors&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;#03F&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Distrito Federal&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;df_leaf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;O c√≥digo acima segue o mesmo racioc√≠nio do criado para o mapa de Londres, por√©m com algumas configura√ß√µes a mais. O arquivo .shp foi inserido diretamente na fun√ß√£o leaflet e na fun√ß√£o addPolygons foram inclu√≠dos os argumentos fill, weight, stroke e color, que representam respectivamente se o interior dos pol√≠gonos devem receber alguma cor, a espessura da linha de contorno, se as linhas dos pol√≠gonos devem ser coloridas e qual a cor escolhida. A fun√ß√£o addLegend cria uma legenda para o mapa. Para mais detalhes sobre fun√ß√µes, basta rodar o seguinte comando: ?nomedafun√ß√£o.&lt;/p&gt;

&lt;iframe title=&quot;London Map&quot; width=&quot;700&quot; height=&quot;400&quot; src=&quot;https://cdn.rawgit.com/jadermcs/9f68419b0b05e32b8741861e80c7df02/raw/b1d9d0394fdd4f724dbc591a14dfa0537baca45e/df.html&quot; frameborder=&quot;0&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
</content>
		</entry>
	
		<entry>
			<title>Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes Parte 3</title>
			<link href="http://lamfo-unb.github.io/2017/05/12/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-3/"/>
			<updated>2017-05-12T17:57:20-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/05/12/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-3</id>
			<content type="html">&lt;h1 id=&quot;aprendizado-semi-supervisionado-para-detec√ß√£o-de-fraudes-parte-3&quot;&gt;Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes [Parte 3]&lt;/h1&gt;

&lt;p&gt;Esta √© a continua√ß√£o (final) da s√©rie de postagens sobre detec√ß√£o de fraudes, &lt;a href=&quot;/2017/05/09/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-1/&quot;&gt;post1&lt;/a&gt;, &lt;a href=&quot;/2017/05/11/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-2/&quot;&gt;post2&lt;/a&gt;. Nesta √∫ltima etapa apresentaremos mais algumas t√©cnicas semi-supervisionadas para detec√ß√£o de anomalia e uma breve conclus√£o. Vamos l√°!&lt;/p&gt;

&lt;h3 id=&quot;modelo-de-m√°quina-de-suporte-vetorial&quot;&gt;Modelo de M√°quina de Suporte Vetorial&lt;/h3&gt;

&lt;p&gt;M√°quinas de Suporte Vetoriais (MSV) s√£o uma classe de modelos originalmente desenhadas para problemas supervisionados de categoriza√ß√£o (ou classifica√ß√£o), em que o objetivo √© separar dois tipos de observa√ß√£o. Intuitivamente, o que os MSVs fazem √© achar o melhor plano de separa√ß√£o entre os dois tipos de dados. Isso pode parecer um pouco restritivo, j√° quem muitas vezes a superf√≠cie que separa duas classes de dados √© composta por v√°rias curvaturas, algo que um plano n√£o conseguiria representar. Para superar essa limita√ß√£o, as MSV fazer uso do truque do kernel, que representa os dados originais em um espa√ßo dimensional maior, de forma que seja poss√≠vel separar os dois tipos nesse novo espa√ßo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/kerneltrick.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Na imagem acima, vemos como o truque do kernel representa dados em altas dimens√µes de forma que eles possam ser separados por um plano. As MSVs n√£o s√£o os √∫nicos modelos que podem se beneficiar do truque do kernel, mas elas s√£o especialmente otimizadas por ele. Na verdade, o truque do kernel √© t√£o computacionalmente ineficiente que se torna praticamente proibitivo de ser utilizado com qualquer t√©cnica que n√£o as m√°quinas de suporte vetorial.&lt;/p&gt;

&lt;p&gt;Na vers√£o n√£o supervisionada da MSV, n√£o estamos interessados em separar dois tipos de dados, pois os dados sequer s√£o nomeados com os tipos. Em vez disso, queremos achar a melhor esfera que encapsule todos os dados. √â f√°cil ver como isso √© √∫til no problema de detec√ß√£o de anomalias: a esfera que contiver os dados normais ser√° definida como nossa fronteira de normalidade, de forma que dados fora dela ser√£o classificados como anomalias. Mas e se os dados normais n√£o se agruparem em uma esfera, mas em uma forma mais complicada? Como talvez, duas esferas ou um ovo? Isso tamb√©m n√£o √© um problema para a vers√£o n√£o supervisionada das MSV, pois podemos usar o truque do kernel e representar os dados em uma dimens√£o maior at√© que eles estejam contidos em uma esfera&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/oneclasssvm.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Na imagem abaixo, por exemplo, a regi√£o de normalidade √© compreendida por duas esferas disjuntas, mas podemos ver como uma MSV consegue representar bem essas fronteiras. Na verdade, n√≥s podemos dizer que o modelo n√£o supervisionado de MSV √© um¬†&lt;strong&gt;aproximador universal de fun√ß√µes densidade de probabilidade&lt;/strong&gt;, isto √©, ele √© capaz de aproximar qualquer distribui√ß√£o poss√≠vel. Uma severa desvantagem desse m√©todo √© o fato dele ser extremamente ineficiente para treinar. Apenas para se ter uma ideia, dos modelos aqui avaliados, o segundo mais demorado de treinar √© o de mistura de gaussianas, que leva aproximadamente 5min. O modelo MSV, por sua vez leva em torno de uma hora.&lt;/p&gt;

&lt;p&gt;Ap√≥s treinado, o modelo produz uma superf√≠cie de separa√ß√£o e n√≥s podemos usar a dist√¢ncia entre uma observa√ß√£o e essa superf√≠cie como uma pontua√ß√£o de anomalia para a observa√ß√£o. Dist√¢ncias negativas significam que a observa√ß√£o est√° fora da esfera definida pela superf√≠cie. Assim, quanto mais negativa a pontua√ß√£o, maior a probabilidade da amostra ser uma anomalia. Usando a subamostra de valida√ß√£o, nomeada com tipos normais e an√¥malos, n√≥s ajustamos um limiar para essa pontua√ß√£o.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/ocsvmtune.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O limiar escolhido foi de -22466.53 e com essa regra de decis√£o conseguimos a seguinte pontua√ß√£o:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,630 \quad P=0,323 \quad F_2=0,529&lt;/script&gt;

&lt;p&gt;Podemos notar que esse modelo n√£o bate o nosso benchmark, mesmo sendo capaz de representar qualquer distribui√ß√£o poss√≠vel. Isso acontece porque todo esse poder vem a um custo de muitas vezes encontrar superf√≠cies de separa√ß√£o mais complicadas do que elas de fato deveriam ser. Algumas vezes - e provavelmente essa √© uma delas - a complexidade adicional tem um custo mais elevado do que o benef√≠cio que se ganha com capacidade. Isso √© o que chamamos de dilema vi√©s-vari√¢ncia em aprendizado de m√°quina. Para mais informa√ß√µes sobre isso, temos tamb√©m &lt;a href=&quot;https://lamfo-unb.github.io/2017/04/29/Um-Olhar-Descontraido-Sobre-o-Dilema-Vies-Variancia/&quot;&gt;esta excelente postagem&lt;/a&gt; que cobre de maneira intuitiva o assunto.&lt;/p&gt;

&lt;p&gt;Por fim, tamb√©m √© interessante notar como esse modelo peca mais em precis√£o, tendo uma revoca√ß√£o aceit√°vel.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/conf-matSVM.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;modelo-de-floresta-de-isola√ß√£o&quot;&gt;Modelo de Floresta de Isola√ß√£o&lt;/h3&gt;

&lt;p&gt;O modelo de floresta de isola√ß√£o √© outro modelo que podemos considerar como um aproximador universal de distribui√ß√µes. Assim, n√£o precisamos colocar nenhuma hip√≥tese restritiva na forma como os dados s√£o distribu√≠dos. Esse modelo √© baseado em estruturas de √°rvores, uma classe de m√©todos de aprendizado de m√°quina que se popularizou muito nos √∫ltimos anos devido a sua simplicidade intuitiva e rapidez de treinamento. O modelo de floresta de isola√ß√£o ajusta v√°rias √°rvores de isola√ß√£o aos dados. Para construir cada √°rvore de isola√ß√£o, primeiro selecionamos aleatoriamente uma das vari√°veis nos dados. Em seguida, selecionamos um valor aleat√≥rio entre o m√°ximo e o m√≠nimo dessa vari√°vel, que ser√° utilizado para separar os dados. N√≥s continuamos fazendo essas segmenta√ß√µes aleat√≥rias at√© que todas as observa√ß√µes estejam isoladas, isto √©, separadas das demais. √Å primeira vista, pode parecer estranho como essas decis√µes aleat√≥rias v√£o nos ajudar a detectar anomalias, mas eis a ideia. Na imagem abaixo, &lt;script type=&quot;math/tex&quot;&gt;X_1&lt;/script&gt; √© uma observa√ß√£o normal e &lt;script type=&quot;math/tex&quot;&gt;X_0&lt;/script&gt; √© uma observa√ß√£o an√¥mala.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/isoforest.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nossa esperan√ßa √© que as anomalias sejam distintas dos dados normais, sendo que esses se aglomeram em algum local do espa√ßo, enquanto que aquelas ficam mais isoladas. Assim, ser√° preciso muito menos segmenta√ß√µes aleat√≥rias para isolar uma anomalia do que para isolar uma observa√ß√£o normal. N√≥s podemos usar o n√∫mero de segmenta√ß√µes at√© uma observa√ß√£o ser isolada como uma pontua√ß√£o de anomalia: quanto maior esse n√∫mero, menor a probabilidade da amostra ser uma anomalia. Quando constru√≠mos v√°rias dessas √°rvores e combinamos a pontua√ß√£o de anomalia delas para conseguir uma pontua√ß√£o final temos uma floresta de isola√ß√£o. Ap√≥s treinada, n√≥s utilizamos a subamostra de valida√ß√£o para ajustar o limiar segundo essa pontua√ß√£o.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/tuneforest.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nosso limiar √≥timo foi de 0,049. Com essa regra de decis√£o, tornamos √† subamostra de teste para produzir uma avalia√ß√£o final. Os resultados foram os seguintes:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,760 \quad P=0,482 \quad F_2=0,681&lt;/script&gt;

&lt;p&gt;Esses resultados batem o nosso benchmark, mas por pouco. Mais uma vez,  notamos que o modelo tem sua performance puxada para baixo pela precis√£o, sendo que a revoca√ß√£o √© bastante boa. Cabe ainda ressaltar que vantagens dessa metodologia frente √†s m√°quinas de suporte vetorial s√£o a velocidade de treinamento e a capacidade de f√°cil paraleliza√ß√£o. Como o treinamento de cada √°rvore √© independente das demais, podemos realiz√°-lo em processos ou m√°quinas separadas, o que aumenta significativamente a rapidez com que treinamos uma floresta. Para finalizar, colocamos abaixo a matriz de confus√£o com respeito a avalia√ß√£o final, na subamostra de teste.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/confmatforest.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;modelo-neural&quot;&gt;Modelo Neural&lt;/h3&gt;

&lt;p&gt;Nos √∫ltimos anos, redes neurais se tornaram o canivete su√≠√ßo de aprendizado de m√°quina, tanto pela sua flexibilidade e efetividade na maioria dos cen√°rios que envolvem problemas estat√≠sticos de alta complexidade e n√£o linearidade. Aqui, n√≥s vamos utilizar um modelo neural chamado autocodificador, no qual pedimos que uma rede neural reconstrua o sinal que lhe √© passado. No nosso caso, vamos pedir que ela reconstrua os dados da transa√ß√£o. Para impedir que a rede neural simplesmente copie o que lhe foi passado como reconstru√ß√£o perfeita, n√≥s colocamos uma camada de neur√¥nios estreita no meio da rede neural. Essa cama ter√° apenas dois neur√¥nios e como os nossos dados t√™m 30 vari√°veis, isso significa que a rede neural ter√° que aprender uma representa√ß√£o interna que condense 30 dimens√µes em apenas duas.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/autoencoder.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;N√≥s vamos treinar um autocodificador utilizando apenas a subamostra de dados normais. Nossa esperan√ßa √© que, ao n√£o ser treinada para reconstruir as anomalias, a rede neural far√° um p√©ssimo trabalho reconstruindo-as, mas far√° um √≥timo trabalho reconstruindo observa√ß√µes normais. Assim, podemos usar o erro de reconstru√ß√£o como uma pontua√ß√£o para anormalidade: quanto maior o erro, maior a probabilidade da observa√ß√£o ser uma anomalia. Uma vez treinada a nossa rede neural, n√≥s utilizamos a subamostra nomeada de valida√ß√£o para ajustar o limiar quanto √† pontua√ß√£o de anomalia.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/tuneautoenc.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O limiar √≥timo foi um erro de 1.69, o que nos deu os seguintes resultados:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,813 \quad P=0,294 \quad F_2=0,601&lt;/script&gt;

&lt;p&gt;Notamos que esse modelo n√£o √© melhor que o nosso benchmark e, mais uma vez, a precis√£o prejudicou a performance do modelo. √â necess√°rio observar que o autocodificador n√£o √© otimizado para detectar anomalias, mas para reconstruir sinais. N√≥s suspeitamos que ele seja t√£o bom nisso que esteja reconstruindo bem tanto o sinal normal quanto o anormal, tornando-o n√£o muito bom para detec√ß√£o de anomalia. Outro aspecto do autocodificador que merece aten√ß√£o √© que ele funciona como um m√©todo de redu√ß√£o de dimens√µes. Como utilizamos apenas dois neur√¥nios na camada estreita, n√≥s guardamos a atividade neural nessa camada como uma representa√ß√£o reduzida dos dados originais. Mais ainda, como temos apenas duas dimens√µes nessa vers√£o reduzida, podemos coloc√°-la em um gr√°fico:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/autoencbiplot.png&quot; width=&quot;600&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Acima, representamos em branco os pontos normais e em preto, os anormais. √â interessante perceber como a maioria das anomalias se agrupam em regi√µes distintas das regi√µes de normalidade. Talvez, o autocodificador n√£o devesse ser utilizado como um m√©todo de detec√ß√£o de anomalias em si, mas como um est√°gio de pr√©-processamento, onde primeiro conseguir√≠amos a representa√ß√£o acima e ent√£o usar√≠amos ela em conjunto com algum outro m√©todo de detec√ß√£o de anomalia. Entretanto, isso ficar√° para um trabalho futuro.&lt;/p&gt;

&lt;p&gt;Abaixo, colocamos a matriz de confus√£o do m√©todo neural para detalhar os tipos de erros que ele comete.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/confmatautoecn.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclus√£o&quot;&gt;Conclus√£o&lt;/h2&gt;

&lt;p&gt;M√©todos semi-supervisionados de aprendizado de m√°quina s√£o excelentes em cen√°rios de detec√ß√£o de anomalias, em que h√° pouqu√≠ssimos exemplos do caso an√¥malo. At√© agora, n√£o encontramos nenhum projeto (no Kaggle) que apresentasse resultados melhores dos aqui apurados. O melhor modelo que desenvolvemos foi o de mistura de gaussianas com um F2-score de 79%. Entretanto, vale ressaltar que esse m√©todo n√£o √© universalmente superior. Em problemas de detec√ß√£o de anomalias, bastante espec√≠ficas de acordo com o dom√≠nio de interesse, √© improv√°vel que um algoritmo seja sempre melhor do que outro.&lt;/p&gt;

&lt;p&gt;Esse post tratou de detec√ß√£o de fraudes, mas as t√©cnicas foram desenvolvidas de forma bastante geral para se estenderem a outras aplica√ß√µes. Algumas delas s√£o: detec√ß√£o de cart√©is, irregularidades em leil√µes, inadimpl√™ncia, sonega√ß√£o e corrup√ß√£o.&lt;/p&gt;
</content>
		</entry>
	
		<entry>
			<title>Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes Parte 2</title>
			<link href="http://lamfo-unb.github.io/2017/05/11/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-2/"/>
			<updated>2017-05-11T09:04:52-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/05/11/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-2</id>
			<content type="html">&lt;h1 id=&quot;aprendizado-semi-supervisionado-para-detec√ß√£o-de-fraudes-parte-2&quot;&gt;Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes [Parte 2]&lt;/h1&gt;

&lt;p&gt;No &lt;a href=&quot;/2017/05/09/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-1/&quot;&gt;post anterior&lt;/a&gt;, vimos o que √© uma anomalia. Agora observaremos a forma de funcionamento de v√°rias t√©cnicas semi-supervisionadas para detec√ß√£o de anomalia.&lt;/p&gt;

&lt;h2 id=&quot;os-dados&quot;&gt;Os dados&lt;/h2&gt;

&lt;p&gt;N√≥s vamos utilizar a base de dados &lt;a href=&quot;https://www.kaggle.com/dalpozz/creditcardfraud&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Credit Card Fraud Detection&lt;/code&gt;&lt;/a&gt; para demonstrar o funcionamento de v√°rias t√©cnicas semi-supervisionadas de detec√ß√£o de anomalia. Segundo a descri√ß√£o providenciada pelo fornecedor, ‚Äúa base de dados cont√©m transa√ß√µes feitas por cart√£o de cr√©dito em setembro de 2013 por consumidores europeus. Os dados s√£o de transa√ß√µes que ocorreram no per√≠odo de dois dias, contando com 284‚Äô807 transa√ß√µes, dentre as quais 492 s√£o fraudes. A base √© altamente desbalanceada; o alvo positivo (fraude) corresponde a apenas 0,172% de todas as transa√ß√µes. Todos os dados s√£o de vari√°veis num√©ricas, que s√£o o resultado de transforma√ß√£o PCA, al√©m de vari√°veis sobre o tempo em que a transa√ß√£o foi efetivada e sobre a quantidade transacionada‚Äù. Para efeito de esclarecimento, a t√©cnica de PCA permite manter a informa√ß√£o integral dos dados ao mesmo tempo que retira sua interpretabilidade. Nesse caso, a t√©cnica foi utilizada para manter o sigilo das informa√ß√µes banc√°rias.&lt;/p&gt;

&lt;p&gt;N√≥s repartimos os dados em 3 subamostras. Em primeiro lugar, reservamos 80% das amostras de transa√ß√µes normais para treino, o que totalizou 227‚Äô452 observa√ß√µes. Essa sub amostra ser√° nossa base de treinamento. Em seguida, n√≥s separamos o restante das observa√ß√µes normais e anormais igualmente, formando duas sub amostras com 28‚Äô677 observa√ß√µes cada, sendo 246 dessas observa√ß√µes an√¥malas. A primeira dessas sub amostrar ser√° nosso set de valida√ß√£o e ser√° utilizada para ajustar o limiar da pontua√ß√£o de anomalia, que ser√° produzida pelo modelo treinado na primeira etapa. Por fim, a √∫ltima subamostra ser√° para testar a performance da t√©cnica considerada.&lt;/p&gt;

&lt;h2 id=&quot;m√©tricas-de-avalia√ß√£o&quot;&gt;M√©tricas de Avalia√ß√£o&lt;/h2&gt;

&lt;p&gt;Em problemas de previs√£o, a m√©trica de avalia√ß√£o mais comum √© a acur√°cia, que mede a propor√ß√£o de acertos. No entanto, nesse cen√°rio, como mais de 99% dos dados pertencem a uma √∫nica categoria, um preditor ing√™nuo prevendo todas as observa√ß√µes como sendo normais j√° conseguiria mais de 99% de acerto. Isso nos motiva a utilizar outras m√©tricas: precis√£o e revoca√ß√£o. Intuitivamente, um sistema com alta revoca√ß√£o e precis√£o baixa apontaria muitas observa√ß√µes como sendo an√¥malas, conseguindo achar a maior parte das anomalias, mas a um custo muito alto em falsos positivos. Por outro lado, um sistema com alta precis√£o e baixa revoca√ß√£o apontaria poucos resultados como sendo transa√ß√µes fraudulentas, acertando-as, por√©m a um custo de v√°rias fraudes passarem despercebidas. Assim, um sistema ideal teria que ponderar precis√£o e revoca√ß√£o em algum ponto √≥timo. Formalmente, tempos precis√£o e revoca√ß√£o definidos como:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;P=\frac{T_p}{T+p + F_p} \quad \quad \quad R=\frac{T_p}{T+p + F_n}&lt;/script&gt;

&lt;p&gt;Em que &lt;script type=&quot;math/tex&quot;&gt;T_p&lt;/script&gt; s√£o os verdadeiros positivos, &lt;script type=&quot;math/tex&quot;&gt;T_n&lt;/script&gt;, os verdadeiros negativos, &lt;script type=&quot;math/tex&quot;&gt;F_p&lt;/script&gt; s√£o os falsos positivos e &lt;script type=&quot;math/tex&quot;&gt;F_n&lt;/script&gt; s√£o os falsos negativos.&lt;/p&gt;

&lt;p&gt;Para que possamos comparar os modelos, √© bom que tenhamos uma √∫nica m√©trica que resuma a performance. Para isso, vamos utilizar o &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score, que combina revoca√ß√£o e precis√£o, dando mais import√¢ncia a primeira. N√≥s optamos por essa m√©trica porque acreditamos ser mais custoso n√£o detectar uma fraude banc√°ria que apontar uma transa√ß√£o como sendo fraudulenta e obter um alarme falso. Assim, desejamos que nosso sistema coloque mais import√¢ncia em conseguir boa revoca√ß√£o. Formalmente, temos:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;F_2-score = (1+2)^2 \ast \frac{P \ast R}{2^2 \ast P + R}&lt;/script&gt;

&lt;h3 id=&quot;benchmark&quot;&gt;Benchmark&lt;/h3&gt;

&lt;p&gt;A maioria dos bons trabalhos que utilizaram essa base de dados fizeram uso de aprendizado puramente supervisionado com alguma t√©cnica para lidar com o desbalanceamento severo entre as categorias. Particularmente, &lt;a href=&quot;https://www.kaggle.com/joparga3/d/dalpozz/creditcardfraud/in-depth-skewed-data-classif-93-recall-acc-now&quot;&gt;este trabalho&lt;/a&gt; dispon√≠vel no Kaggle conseguiu uma precis√£o de 0,883, uma revoca√ß√£o de 0,619 e um &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score de 0,658. Como esse √© o melhor resultado que achamos dentre os trabalhos dispon√≠veis no Kaggle, vamos tom√°-lo como benchmark.&lt;/p&gt;

&lt;h2 id=&quot;t√©cnicas-de-detec√ß√£o-de-anomalias&quot;&gt;T√©cnicas de Detec√ß√£o de Anomalias&lt;/h2&gt;

&lt;h3 id=&quot;modelo-gaussiano&quot;&gt;Modelo Gaussiano&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/unigaussian.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A distribui√ß√£o gaussiana √© dada pela curva em formato de sino (acima) e √©, com certeza, o modelo estat√≠stico mais famoso, principalmente porque muitos fen√¥menos do dia a dia se encaixam muito bem nela. Intuitivamente, se um fen√¥meno tem comportamento gaussiano, podemos dizer que 95% das realiza√ß√µes desse fen√¥meno aconteceram a no m√°ximo 2 desvios padr√µes de dist√¢ncia da m√©dia. Por exemplo, se a quantidade m√©dia transacionada por cart√£o de cr√©dito for de R$¬†50,00, com um desvio padr√£o de R$¬†10,00, podemos dizer que 95% das transa√ß√µes ser√£o de um valor entre 30 e 70 reais. Mais ainda, n√≥s podemos dizer que transa√ß√µes fora desse intervalo s√£o bastante improv√°veis, indicando que podem ser anomalias.
Aqui, n√≥s estendemos a distribui√ß√£o gaussiana para o seu caso multivariado, para assim capturar intera√ß√µes entre vari√°veis. Por exemplo, pode ser que uma grande quantia transacionada por si s√≥ n√£o seja estranha, mas essa mesma quantia em uma especifica hora do dia, digamos de madrugada, seja. N√≥s podemos ent√£o modelar as margens da normalidade pela intera√ß√£o entre hora do dia e quantidade transacionada.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/multigaussian.png&quot; width=&quot;450&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Nossos dados cont√™m 30 vari√°veis, logo n√£o podemos visualiz√°-los em um gr√°fico como o acima. No entanto, achar uma gaussiana de 30 dimens√µes √© t√£o simples quanto achar uma de duas e √© isso que fizemos com os nossos dados de treino, isto √©, a subamostra n√£o nomeada. Quando encontramos a gaussiana multidimensional que melhor se encaixa nos dados, n√≥s podemos extrair a probabilidade de cada observa√ß√£o, que seria a altura da gaussiana multidimensional. Em seguida, n√≥s usamos a subamostra (nomeada) de valida√ß√£o para ajustar um limiar a partir do qual considerar√≠amos uma transa√ß√£o como an√¥mala. Apenas para efeito de clarifica√ß√£o, ao inv√©s de usar a probabilidade para decidir o limiar, n√≥s usamos o logaritmo da probabilidade (fizemos isso pois a probabilidade √© um n√∫mero muito pequeno que poderia dar problemas de precis√£o num√©rica, devido a capacidade limitada do computador em representar n√∫meros com muitas casas decimais). Abaixo, vemos como as nossas tr√™s m√©tricas de avalia√ß√£o evoluem conforme mudamos o limiar.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/gaussiantuning.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O limiar √≥timo escolhido foi de -269, isto √©, amostras com uma log probabilidade menor do que essa ser√£o consideradas anomalias pelo nosso modelo. Com essa regra aprendida, n√≥s criamos a subamostra de teste para uma avalia√ß√£o final. As pontua√ß√µes nessa subamostra foram:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,793 \quad P=0,701 \quad F_2=0,773&lt;/script&gt;

&lt;p&gt;Apenas para que fique claro, uma revoca√ß√£o de 0,793 indica que, de todas as transa√ß√µes fraudulentas, n√≥s conseguimos identificar 79,3% delas; uma precis√£o de 0,701 indica que, de todas as transa√ß√µes que previmos como sendo fraudulentas, 70,1% delas de fato o eram. O &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score n√£o tem nenhuma interpreta√ß√£o intuitiva. Ele √© apenas uma m√©trica que combina as outras duas de forma que possamos comparar os modelos mais facilmente. Por exemplo, podemos dizer que esse modelo √© mais de 10 pontos melhor do que o nosso benchmark, que obteve um &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score de apenas 0,658. Abaixo est√° a matriz de confus√£o para mais detalhes sobre como o modelo classificou cada transa√ß√£o.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/confmatgaussian.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;modelo-histograma&quot;&gt;Modelo Histograma&lt;/h3&gt;

&lt;p&gt;Nem todas as vari√°veis dos nossos dados seguem uma distribui√ß√£o gaussiana. Se plotarmos o histograma de algumas caracter√≠sticas, podemos ver isso claramente. A come√ßar pela distribui√ß√£o da vari√°vel que mede a quantidade transacionada, que tem uma distribui√ß√£o bastante complicada, tanto para os dados normais quanto para os anormais. (Novamente, para efeito de esclarecimento, transformamos a vari√°vel de quantidade transacionada em sua forma logar√≠tmica. Isso costuma deixar as distribui√ß√µes mais balanceadas).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/hist1.png&quot; width=&quot;500&quot; /&gt;
&lt;img src=&quot;/img/anomalia/hist2.png&quot; width=&quot;500&quot; /&gt;
&lt;img src=&quot;/img/anomalia/hist3.png&quot; width=&quot;500&quot; /&gt;
&lt;img src=&quot;/img/anomalia/hist4.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Quando vemos esses histogramas, notamos facilmente como algumas vari√°veis s√£o √≥timos indicadores de anomalias, uma vez que a distribui√ß√£o (aproximada pelo histograma) dos dados an√¥malos e dos dados normais s√£o bastante distingu√≠veis. Veja por exemplo a vari√°vel &lt;code class=&quot;highlighter-rouge&quot;&gt;V10&lt;/code&gt;. A distribui√ß√£o dos dados normais parece uma gaussiana bastante concentrada no zero, ao passo que os dados anormais parecem seguir uma distribui√ß√£o bimodal, com um pico em aproximadamente -5 e outro em -15.&lt;/p&gt;

&lt;p&gt;N√≥s vamos explorar essa diferen√ßa nos histogramas para construir uma pontua√ß√£o de normalidade que ser√° proporcional √† probabilidade dos dados corresponderem a uma transa√ß√£o normal. Em primeiro lugar, vamos usar os dados de treinamento (n√£o nomeados e com exemplos apenas dos casos normais) para estimar um histograma para cada vari√°vel nos dados. Assim, na hora de avaliar uma nova observa√ß√£o, n√≥s analisamos em qual dos compartimentos dos histogramas cada uma de suas vari√°veis cai. A pontua√ß√£o de normalidade ser√° ent√£o a m√©dia da altura desses compartimentos. √â f√°cil perceber que se a observa√ß√£o for normal, ela cair√° em uma regi√£o do histograma com compartimentos bastante altos.&lt;/p&gt;

&lt;p&gt;Uma vez treinado esse modelo, vamos ajustar o limiar para essa nossa pontua√ß√£o usando a subamostra de valida√ß√£o, que inclui dados nomeados, tanto do caso normal quanto do caso anormal.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/histtuning.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O melhor limiar, de acordo com o &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score, foi 36161. Com o modelo assim ajustado, conseguimos os seguintes resultados:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,646 \quad P=0,170 \quad F_2=0,415&lt;/script&gt;

&lt;p&gt;Observamos que esse modelo n√£o √© melhor que nosso benchmark, conseguindo um &lt;script type=&quot;math/tex&quot;&gt;F_2&lt;/script&gt;-score de apenas 0,41.  A performance do modelo √© particularmente prejudicada pela baixa precis√£o, de 0,17. Isso indica que, de todas as observa√ß√µes que esse modelo classifica como sendo fraudulentas, apenas 17% delas de fato o s√£o. Assim, o modelo incorre a um elevado custo em termos de falsos positivos. Devemos notar que esse modelo √© capaz de aproximar qualquer distribui√ß√£o por vari√°vel, mas n√£o consegue capturar rela√ß√µes entre vari√°veis. Aparentemente, conseguir capturar intera√ß√µes √© algo bastante importante nos dados aqui presente. Abaixo, na matriz de confus√£o, temos uma ideia melhor do tipo de erro que estamos cometendo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/confmathist.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;modelo-de-mistura-de-gaussianas&quot;&gt;Modelo de Mistura de Gaussianas&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/gmm.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Anteriormente, no modelo gaussiano n√≥s assumimos que os dados vinham de uma distribui√ß√£o gaussiana multidimensional. Isso talvez seja um pouco restritivo. Como vimos nos histogramas acima, nem todas as vari√°veis seguem um modelo gaussiano. N√≥s podemos utilizar um modelo que relaxa essa hip√≥tese, assumindo que os dados v√™m de uma distribui√ß√£o que √© uma¬†&lt;strong&gt;mistura de gaussianas&lt;/strong&gt;. Pela imagem acima, observamos que essa hip√≥tese n√£o √© nem um pouco restritiva e que distribui√ß√µes bastante complexas podem ser representadas por misturas de gaussianas. De fato, contanto que tenhamos gaussianas suficiente, qualquer distribui√ß√£o poder√° ser aproximada por uma mistura de gaussiana.&lt;/p&gt;

&lt;p&gt;Se quisermos capturar intera√ß√µes entre vari√°veis, √© f√°cil o suficiente estender o modelo para uma mistura de gaussianas multivariadas, como na imagem abaixo (dimens√£o da probabilidade/altura est√° suprimida e representada como curva de n√≠vel):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/gmmmultivariate.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;No nosso modelo de detec√ß√£o de anomalias, n√≥s ajustamos 3 gaussianas aos dados com um algoritmo de Expectativa-Maximiza√ß√£o. Fizemos isso utilizando apenas os dados de treino, que n√£o estavam nomeados e que continham apenas casos de transa√ß√µes normais. Com esse modelo treinado, conseguimos mais uma vez ter acesso direto √† probabilidade de cada amostra e mais uma vez optamos por utilizar o logaritmo da probabilidade para n√£o ter que lidar com muitas casas decimais. Na subamostra de valida√ß√£o com dados nomeados, ajustamos um limiar para o logaritmo da probabilidade, para decidir abaixo de que pontua√ß√£o considerar√≠amos uma anomalia. A evolu√ß√£o das tr√™s m√©tricas conforme a evolu√ß√£o do limiar pode ser conferida abaixo.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/gmmtune.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;O limiar √≥timo escolhido foi de -101, de forma que observa√ß√µes com uma pontua√ß√£o menor do que isso seriam consideradas an√¥malas. Por fim, tornamos √† subamostra de teste para uma avalia√ß√£o final. Os resultados foram os seguintes:&lt;/p&gt;

&lt;script type=&quot;math/tex; mode=display&quot;&gt;R=0,809 \quad P=0,726 \quad F_2=0,791&lt;/script&gt;

&lt;p&gt;Esse foi o nosso melhor modelo, com elevada revoca√ß√£o e precis√£o. Para mais informa√ß√µes sobre o tipo de erro que esse modelo comete, abaixo colocamos a matriz de confus√£o da avalia√ß√£o final, na subamostra de teste.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/confmatgmm.png&quot; width=&quot;500&quot; /&gt;&lt;/p&gt;

&lt;p&gt;No post 3 analisaremos mais algumas t√©cnicas de detec√ß√£o de anomalia.
&lt;a href=&quot;/2017/05/12/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-3/&quot;&gt;Parte 3 - Final&lt;/a&gt;&lt;/p&gt;
</content>
		</entry>
	
		<entry>
			<title>Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes Parte 1</title>
			<link href="http://lamfo-unb.github.io/2017/05/09/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-1/"/>
			<updated>2017-05-09T09:04:52-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/05/09/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-1</id>
			<content type="html">&lt;h1 id=&quot;aprendizado-semi-supervisionado-para-detec√ß√£o-de-fraudes-parte-1&quot;&gt;Aprendizado Semi-Supervisionado para Detec√ß√£o de Fraudes [Parte 1]&lt;/h1&gt;

&lt;p&gt;Seja para detectar falhas em um avi√£o ou usina nuclear, seja para perceber gastos il√≠citos de um deputado ou seja para apontar sonega√ß√£o no imposto de renda, a arte de notar comportamentos e padr√µes suspeitos pode ser bastante √∫til em diversos cen√°rios. Pensando nisso, preparamos uma pequena lista de procedimentos para esse tipo de tarefa. Algumas delas ser√£o incrivelmente simples e surpreendentemente efetivas. Outras, nem t√£o simples assim. De qualquer forma vamos nos concentrar em &lt;strong&gt;t√©cnicas de aprendizado de m√°quina semi-supervisionado para detec√ß√£o de anomalias&lt;/strong&gt;. N√£o se preocupe se isso soou confuso. Antes de mais nada, vamos explicar tanto o que s√£o anomalias quanto o que √© aprendizado de m√°quina semi-supervisionado. Em seguida, vamos fornecer uma explica√ß√£o intuitiva do funcionamento de cada uma das t√©cnicas aqui explicadas, assim como esclarecer suas vantagens e desvantagens. Esse trabalho √© livremente inspirado em uma pesquisa em que Chandola et al (2009) compilam v√°rias t√©cnicas de detec√ß√£o de anomalia.&lt;/p&gt;

&lt;p&gt;Essa pesquisa n√£o pretende ser extensiva e nem rigorosa; nossa esperan√ßa √© sermos o menos complicado poss√≠vel na linguagem e o mais direto poss√≠vel nas explica√ß√µes intuitivas. Para uma vers√£o mais detalhada e t√©cnica, voc√™ pode conferir &lt;a href=&quot;https://www.kaggle.com/matheusfacure/d/dalpozz/creditcardfraud/semi-supervised-anomaly-detection-survey&quot;&gt;implementa√ß√£o que fizemos diretamente no Kaggle&lt;/a&gt; (em ingl√™s).&lt;/p&gt;

&lt;h2 id=&quot;o-que-√©-uma-anomalia&quot;&gt;O que √© uma anomalia?&lt;/h2&gt;

&lt;p&gt;‚ÄúAnomalias s√£o padr√µes nos dados que n√£o obedecem bem as no√ß√µes definidas como normalidade‚Äù (Chandola et al, 2009). Em outras palavras, s√£o dados que apresentam algum comportamento estranho, distinto do padr√£o normal. Por exemplo, os pontos¬†&lt;script type=&quot;math/tex&quot;&gt;O_1&lt;/script&gt;,¬†&lt;script type=&quot;math/tex&quot;&gt;O_2&lt;/script&gt;¬†na imagem abaixo est√£o isolados e fora das regi√µes de normalidade (&lt;script type=&quot;math/tex&quot;&gt;N_1&lt;/script&gt;¬†e¬†&lt;script type=&quot;math/tex&quot;&gt;N_2&lt;/script&gt;), sendo assim considerados anomalias. Os pontos na regi√£o¬†&lt;script type=&quot;math/tex&quot;&gt;O_3&lt;/script&gt;, embora tenham uma vizinhan√ßa, tamb√©m s√£o anomalias, pois a regi√£o inteira est√° fora da de normalidade.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/anomalia/anomaly.png&quot; width=&quot;400&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Assim sendo, uma abordagem bastante direta para detec√ß√£o de anomalias seria simplesmente definir a regi√£o onde os dados normais est√£o presentes e classificar tudo o que aparecer fora dessa regi√£o como anomalia. No entanto, isso √© mais f√°cil de falar do que de fazer e h√° alguns desafios bastante complicados que surgem em problemas de detec√ß√£o de anomalias:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Modelar uma regi√£o que capture todas as no√ß√µes de normalidade √© extremamente dif√≠cil e as fronteiras entre normal e anormal geralmente n√£o s√£o bem definidas;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Anomalias podem ser o resultado de atividade maliciosa (e.g. fraudes banc√°rias). Nesse caso, h√° um advers√°rio que est√° sempre tentando se adaptar para fazer com que as observa√ß√µes an√¥malas pare√ßam normais;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;O que √© normal pode mudar, isto √©, uma no√ß√£o de normalidade definida hoje pode n√£o ser v√°lida no futuro;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;A no√ß√£o de normalidade varia muito de aplica√ß√£o para aplica√ß√£o e n√£o h√° um algoritmo geral o suficiente para captur√°-la de forma √≥tima;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Conseguir amostrar o comportamento¬†&lt;strong&gt;anormal&lt;/strong&gt;¬†√© geralmente um dos maiores problemas em detec√ß√£o de anomalias, sendo essas amostras extremamente escassas ou at√© mesmo inexistentes.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Para lidar com esses problemas, n√≥s sugerimos uma abordagem semi-supervisionada, que n√£o requer nada al√©m de uma pequena parcela de amostras anormais.&lt;/p&gt;

&lt;h2 id=&quot;o-que-√©-aprendizado-de-m√°quina-semi-supervisionado&quot;&gt;O que √© aprendizado de m√°quina semi-supervisionado&lt;/h2&gt;

&lt;p&gt;Aprendizado de m√°quina √© uma ci√™ncia que utiliza m√©todos da ci√™ncia da computa√ß√£o e estat√≠stica para analisar dados. As t√©cnicas de aprendizado de m√°quina surgiram dentro do campo de intelig√™ncia artificial, como um meio de permitir que os computadores aprendessem uma forma de conhecimento pr√≥pria. Hoje, aprendizado de m√°quina se expandiu em um campo aut√¥nomo e tem obtido sucessos tamb√©m em problemas que demandam racioc√≠nio estat√≠stico al√©m da capacidade humana. Dentro dos regimes de aprendizado de m√°quina, destaca-se o de aprendizado de m√°quina supervisionado, que foca em problemas de previs√£o: tendo uma base de dados com ‚Äúalvos‚Äù para cada observa√ß√£o (pares &lt;script type=&quot;math/tex&quot;&gt;(x,y)&lt;/script&gt;), a meta √© aprender quais ‚Äúalvos‚Äù (&lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt;) est√£o associados a quais dados (&lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;). Isso √© feito apresentando ao computador pares suficientes de dados e alvos, at√© que ele aprenda a associar um ao outro. Alguns exemplos desse tipo de problema s√£o: identificar a presen√ßa de uma doen√ßa (alvo), dado os sintomas do paciente (dados); prever se o pre√ßo da a√ß√£o de uma empresa vai subir ou cair (alvo), dado o hist√≥rico do mercado financeiro (dados); identificar de que pessoa √© a face (alvo) em uma imagem (dados) ou classificar um livro (dados) em uma escola liter√°ria (alvo).&lt;/p&gt;

&lt;p&gt;Uma limita√ß√£o de aprendizado de m√°quina supervisionado √© que pode ser extremamente custoso conseguir os alvos para cada observa√ß√£o (n√≥s chamamos isso de nomear a base de dados). Por exemplo, considere o problema de prever o tema de um artigo de jornal (alvo) dado o seu conte√∫do escrito (dados). Para que um computador fa√ßa isso, √© preciso que antes algu√©m tenha lido uma grande quantidade (muitas vezes, milhares) de artigos e nomeado cada um com um tema. Assim, o computador ter√° acesso tanto ao conte√∫do, quanto ao alvo que ele precisa prever, nesse caso o tema do artigo. Em cen√°rios de detec√ß√£o de anomalias, muitas vezes n√≥s s√≥ temos dados que representam o caso normal, sendo extremamente dif√≠cil conseguir dados que representam anomalias. Em alguns extremos, como, por exemplo, o problema de detectar falhas em uma usina nuclear, conseguir exemplos de falhas cr√≠ticas √© tanto imposs√≠vel quanto indesej√°vel. Assim, com poucos ou nenhum exemplo do que √© um caso anormal, o computador n√£o tem informa√ß√£o suficiente para aprender os padr√µes estat√≠sticos da anormalidade, tornando o problema de detect√°-la extremamente dif√≠cil.&lt;/p&gt;

&lt;p&gt;Uma possibilidade √© utilizar¬†&lt;strong&gt;aprendizado de m√°quina semi-supervisionado, em que consideramos apenas uma pequena parcela dos dados como estando nomeada&lt;/strong&gt;¬†e que os dados n√£o nomeados s√≥ cont√™m exemplos do caso normal, que geralmente √© abundante. Assim, n√≥s utilizamos t√©cnicas de aprendizado &lt;strong&gt;n√£o&lt;/strong&gt; supervisionado (para aprender a estrutura dos dados) nos dados n√£o nomeados para extrair alguma no√ß√£o de normalidade. Ao final dessa etapa n√£o supervisionada, a m√°quina conseguir√° associar cada observa√ß√£o com uma pontua√ß√£o proporcional √† probabilidade do dado ter vindo da regi√£o normal. Em seguida, usamos a parte nomeada dos dados (com exemplos tanto de anomalias, quanto do caso normal) para definir um limiar na pontua√ß√£o, a partir do qual consideraremos a amostra como an√¥mala.&lt;/p&gt;

&lt;p&gt;OK‚Ä¶ Talvez esse √∫ltimo par√°grafo contenha muitas e complexas informa√ß√µes, o que torna a compreens√£o mais lenta. Pense no seguinte: primeiro, n√≥s ensinamos a m√°quina apenas como √© o caso normal, pois n√£o temos (muitos) exemplos de anomalias; em seguida, n√≥s usamos um pouco dos exemplos de casos anormais para refinar a percep√ß√£o de normalidade da m√°quina; por fim, utilizamos o resto dos dados - com um pouco de casos anormais e muitos casos normais ‚Äì para produzir uma avalia√ß√£o final do nosso m√©todo de detec√ß√£o de anomalias. Se voc√™ ainda n√£o entendeu, n√£o se preocupe. Logo mais colocaremos um estudo emp√≠rico com v√°rios exemplos utilizando m√©todos de aprendizado semi-supervisionado para detectar fraudes.&lt;/p&gt;

&lt;p&gt;Continua‚Ä¶ &lt;a href=&quot;/2017/05/11/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-2/&quot;&gt;Parte 2&lt;/a&gt; &lt;a href=&quot;/2017/05/12/Aprendizado-Semi-Supervisionado-para-Deteccao-de-Fraudes-Parte-3/&quot;&gt;Parte 3&lt;/a&gt;&lt;/p&gt;
</content>
		</entry>
	
		<entry>
			<title>Um Olhar Descontra√≠do Sobre o Dilema Vi√©s-Vari√¢ncia</title>
			<link href="http://lamfo-unb.github.io/2017/04/29/Um-Olhar-Descontraido-Sobre-o-Dilema-Vies-Variancia/"/>
			<updated>2017-04-29T20:59:07-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/04/29/Um-Olhar-Descontraido-Sobre-o-Dilema-Vies-Variancia</id>
			<content type="html">&lt;h1 id=&quot;um-olhar-descontra√≠do-sobre-o-dilema-vi√©s-vari√¢ncia&quot;&gt;Um Olhar Descontra√≠do Sobre o Dilema Vi√©s-Vari√¢ncia&lt;/h1&gt;

&lt;p&gt;Fazer previs√µes √© uma das principais ambi√ß√µes do ser humano. Uma pessoa pode ter a motiva√ß√£o de saber prever quase qualquer coisa, desde o placar de um evento esportivo at√© o pre√ßo de uma a√ß√£o ou o humor da sua namorada‚Ä¶ Mas o futuro √© uma vari√°vel aleat√≥ria ‚Äì ningu√©m sabe de fato como vai ser, qualquer previs√£o √© em ess√™ncia um ‚Äúchute‚Äù. Bem, como chutar ent√£o? Voc√™ pode simplesmente jogar uma moeda, isso √© bem conveniente, mas certamente n√£o d√° o melhor chute poss√≠vel. √â a√≠ que entra a estat√≠stica, uma √°rea do conhecimento que defino sucintamente como ‚Äúa ci√™ncia do chute‚Äù.&lt;/p&gt;

&lt;p&gt;Enquanto o futuro √© um inerente mist√©rio, o passado √© um ambiente onde n√£o h√° mais incerteza, ent√£o nada mais natural e sensato que tentar prever o futuro com base no que j√° aconteceu. A grosso modo, com base em potenciais elementos (uma lista de &lt;script type=&quot;math/tex&quot;&gt;x_1,x_2,...,x_k&lt;/script&gt; vari√°veis independentes) que influenciem essa vari√°vel que se deseja prever (uma vari√°vel dependente &lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt;), tentar chutar valores futuros de &lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt; ao se coletar novos valores dos &lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;‚Äôs (em aprendizado de m√°quina, o jarg√£o para isso √© ‚Äúaprendizagem supervisionada‚Äù). Ou seja, a estat√≠stica busca fornecer o melhor chute, condicionado √†s informa√ß√µes dispon√≠veis.&lt;/p&gt;

&lt;p&gt;Pense intuitivamente: por mais que o futuro possa trazer uma coisa completamente diferente de tudo que j√° foi visto, √© razo√°vel assumir que o futuro e o passado compartilham de certos &lt;strong&gt;padr√µes&lt;/strong&gt;, conex√µes que fazem as duas inst√¢ncias temporais serem manifesta√ß√µes de um mesmo fen√¥meno. Para obter bons chutes, um conceito bem importante √© o chamado &lt;strong&gt;dilema vi√©s-vari√¢ncia&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;o-que-isso-quer-dizer&quot;&gt;O que isso quer dizer?&lt;/h4&gt;

&lt;p&gt;Vamos discutir primeiro o ‚Äúvi√©s‚Äù. √â f√°cil imaginar que, para ser capaz de prever com exatid√£o o futuro, primeiro √© preciso entender bem o passado. Um preditor que n√£o consegue mapear bem as caracter√≠sticas daquilo que j√° se observou claramente tende a n√£o se sair bem para o futuro. O que aqui chamamos de ‚Äúvi√©s‚Äù s√£o os desvios entre aquilo que se observou no passado e aquilo que se prev√™ pelo modelo proposto ‚Äì em suma, √© o qu√£o bem o modelo est√° &lt;strong&gt;descrevendo&lt;/strong&gt; os dados observados.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/chunk-8.png&quot; alt=&quot;alt text&quot; title=&quot;Distribui√ß√µes&quot; /&gt;&lt;/p&gt;

&lt;p&gt;√â natural pensar que quanto melhor o modelo descreve os dados da amostra, melhor ele √©. Por√©m, isso n√£o √© verdade, pois o objetivo primordial &lt;strong&gt;n√£o&lt;/strong&gt; √© descrever os dados, mas us√°-los para fazer previs√µes (ou &lt;strong&gt;infer√™ncias&lt;/strong&gt;) sobre o futuro. Isso nos leva para o lado da ‚Äúvari√¢ncia‚Äù:&lt;/p&gt;

&lt;p&gt;O objetivo aqui √© conseguir prever a vari√°vel de interesse com base em &lt;strong&gt;alguns&lt;/strong&gt; elementos. De cara temos um problema, pois aquilo que efetivamente vemos √© apenas uma parte do fen√¥meno todo; ent√£o, se nos atermos demais a simplesmente descrever os dados dispon√≠veis, estamos no fundo torcendo para que o &lt;strong&gt;mesmo padr√£o observado se repita para o futuro&lt;/strong&gt;, o que claramente n√£o √© verdade. Para poder &lt;strong&gt;generalizar&lt;/strong&gt; o que se observou para amostras futuras ‚Äì ou seja, antecipar alguma coisa que ainda n√£o aconteceu ‚Äì √© preciso calibrar o modelo de modo a capturar apenas o ‚Äúessencial‚Äù, informa√ß√µes que realmente contribuem para uma boa previs√£o, em vez de captar por completo os padr√µes daquela amostra espec√≠fica, pois ao fazer isso, informa√ß√µes in√∫teis (‚Äú&lt;strong&gt;ru√≠do&lt;/strong&gt;‚Äù) acabam sendo incorporadas ao mesmo tempo. Basicamente, ao for√ßar uma descri√ß√£o muito fiel dos dados da amostra, acaba que se perde em capacidade de generaliza√ß√£o, pois o futuro em geral &lt;strong&gt;n√£o&lt;/strong&gt; √© uma extens√£o do passado.&lt;/p&gt;

&lt;p&gt;Modelos que descrevem excessivamente bem os dados de uma amostra tendem a introduzir muita complexidade e volatilidade, de modo a prejudicar a capacidade de generaliza√ß√£o. Na filosofia da ci√™ncia h√° um princ√≠pio chamado ‚Äúnavalha de Occam‚Äù, os estat√≠sticos conhecem como ‚Äúprinc√≠pio da parcim√¥nia‚Äù; a cultura popular adotou um mnem√¥mico um tanto quanto √°cido:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;‚ÄúKISS ‚Äì &lt;strong&gt;keep it simple, stupid&lt;/strong&gt;‚Äú&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Basicamente, quer dizer que entre modelos com mesmo poder explicativo, o mais simples deles √© o melhor, pois apresenta a mesma qualidade com um custo menor.&lt;/p&gt;

&lt;p&gt;A essa altura, voc√™ j√° deve ter percebido que estamos diante de um cobertor curto, pois o cen√°rio ideal que buscamos possui as duas caracter√≠sticas desej√°veis, por√©m contradit√≥rias: queremos um modelo que descreva bem os dados dispon√≠veis &lt;strong&gt;E&lt;/strong&gt; que seja capaz de generalizar para dados futuros. Se temos um modelo que se ajusta mal aos dados do passado (‚Äúunder-fitting‚Äù), o modelo j√° come√ßa com pouca confiabilidade, pois n√£o est√° sendo fiel √†s informa√ß√µes dispon√≠veis; por outro lado, um ajustamento excessivo (‚Äúover-fitting‚Äù) acaba assumindo que o futuro ir√° repetir o passado, de modo que o modelo tende a fornecer uma p√©ssima previs√£o para observa√ß√µes que sejam apenas um pouquinho fora daquele padr√£o dos dados passados.&lt;/p&gt;

&lt;p&gt;O dilema vi√©s-vari√¢ncia √© muito importante na constru√ß√£o de modelos matem√°ticos: a qualidade de um modelo depende diretamente das vari√°veis consideradas, e saber achar o meio-termo entre incorporar vari√°veis √∫teis e descartar vari√°veis in√∫teis pode ser um desafio e tanto. Vejamos um exemplo simplista: suponha que queremos construir um modelo para prever o pre√ßo de uma a√ß√£o de uma empresa. √â de se esperar que o desempenho econ√¥mico da empresa tenha uma influ√™ncia decisiva no pre√ßo da a√ß√£o, ent√£o podemos colocar como vari√°veis alguns indicadores como √≠ndice de lucratividade e liquidez, o &lt;strong&gt;market share&lt;/strong&gt; da empresa, n√∫mero de filiais, e por a√≠ vai.&lt;/p&gt;

&lt;p&gt;Poder√≠amos colocar por exemplo ‚Äúescolaridade do CEO‚Äù como uma vari√°vel explicativa; √© de se esperar que um gestor com uma forma√ß√£o acad√™mica mais robusta possa incrementar o valor da companhia, mas a rela√ß√£o j√° n√£o parece t√£o direta assim‚Ä¶ Poder√≠amos colocar como vari√°vel se o CEO da empresa √© destro, canhoto ou ambidestro, mas essa informa√ß√£o tende a n√£o influenciar em nada na vari√°vel que se deseja prever, e a introdu√ß√£o dessa vari√°vel acabaria poluindo o modelo com uma &lt;strong&gt;complexidade desnecess√°ria&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Note que n√£o h√° limites para a criatividade do pesquisador, e teoricamente poder√≠amos colocar um n√∫mero gigantesco de vari√°veis. Mas √† medida que vari√°veis com menor relev√¢ncia v√£o sendo inseridas, chega um momento em que a ‚Äúvari√¢ncia‚Äù introduzida pela nova vari√°vel n√£o compensa o &lt;strong&gt;poder explicativo&lt;/strong&gt; que ela agrega ao modelo.&lt;/p&gt;

&lt;p&gt;Saber encontrar o meio-termo ideal entre vi√©s e vari√¢ncia n√£o √© uma tarefa f√°cil, h√° diversas t√©cnicas para nos ajudar com isso, tais como valida√ß√£o cruzada e redu√ß√£o de dimensionalidade, podemos abordar esses t√≥picos em posts futuros.&lt;/p&gt;
</content>
		</entry>
	
		<entry>
			<title>A Casual Look at the Bias-Variance Dilemma</title>
			<link href="http://lamfo-unb.github.io/2017/04/29/A-Casual-Look-at-the-Bias-Variance-Dilemma/"/>
			<updated>2017-04-29T20:59:07-03:00</updated>
			<id>http://lamfo-unb.github.io/2017/04/29/A-Casual-Look-at-the-Bias-Variance-Dilemma</id>
			<content type="html">&lt;h1 id=&quot;a-casual-look-at-the-bias-variance-dilemma&quot;&gt;A Casual Look at the Bias-Variance Dilemma&lt;/h1&gt;

&lt;p&gt;Making predictions is one of the main ambitions of the human race. One may have the motivation to forecast almost anything from a sports event to the stock price or his girlfriend‚Äôs mood‚Ä¶ But the future is a random variable ‚Äì no one really knows how it‚Äôs gonna be, so any prediction is in essence a ‚Äúguess‚Äù. Well, how to guess then? You can simply toss a coin, this is quite convenient, but it certainly does not give the best guess possible. This is where statistics comes to stage, as I define briefly that knowledge field as ‚Äúthe science of guessing‚Äù.&lt;/p&gt;

&lt;p&gt;While the future is an inherent mystery, the past is an environment where uncertainty doesn‚Äôt exist anymore, so it‚Äôs only natural and reasonable trying to predict the future based on what has already happened. Roughly, based on elements (a list of &lt;span&gt;&lt;script type=&quot;math/tex&quot;&gt;x_1,x_2,...,x_k&lt;/script&gt;&lt;/span&gt; independent variables) that may have influence on the variable to be predicted (a dependent variable &lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt;), the goal is to try and guess future values of &lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt; by collecting new values of the &lt;script type=&quot;math/tex&quot;&gt;x&lt;/script&gt;‚Äôs (in machine learning, the jargon for this is ‚Äúsupervised learning‚Äù). That is, statistics seek to provide the best guess, conditioned to the available information.&lt;/p&gt;

&lt;p&gt;Think intuitively: even though the future may bring in stuff completely different from anything seen in the past, it‚Äôs reasonable to assume that both future and past share certain &lt;strong&gt;patterns&lt;/strong&gt;, connections that make those two temporal instances a manifestation of the same phenomenon. To get good guesses, a very important concept is called &lt;strong&gt;bias-variance dilemma&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;what-does-it-mean-exactly&quot;&gt;What does it mean exactly?&lt;/h4&gt;

&lt;p&gt;Let‚Äôs first discuss ‚Äúbias‚Äù. It‚Äôs easy to imagine that in order to accurately predict the future, one must first understand the past well. A predictor that fails to map clearly the characteristics of clearly observed data tends not perform badly for the future. What we call ‚Äúbias‚Äù are the deviations between the observed in the past and the predicted by the proposed model ‚Äì in short, how well the model is &lt;strong&gt;describing&lt;/strong&gt; the observed data.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/chunk-8.png&quot; alt=&quot;alt text&quot; title=&quot;Distribution&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It is natural to think that the better the model describes the sample data, the better it is. But this is not true, since the primary purpose is &lt;strong&gt;not&lt;/strong&gt; to describe the data, but rather to use those to make predictions (or &lt;strong&gt;inferences&lt;/strong&gt;) about the future. This brings us to the ‚Äúvariance‚Äù side:&lt;/p&gt;

&lt;p&gt;Our goal here is to be able to predict the variable of interest &lt;script type=&quot;math/tex&quot;&gt;y&lt;/script&gt; based on &lt;strong&gt;some&lt;/strong&gt; elements of the whole population, so we have a major problem from the start, for what we actually see in the sample is only part of the whole phenomenon; so if we simply stick onto describing the already available data, we essencially &lt;strong&gt;hoping that the same pattern will repeat in the future&lt;/strong&gt;, which clearly doesn‚Äôt always happens. To be able to &lt;strong&gt;generalize&lt;/strong&gt; what has been observed for future samples ‚Äì that is, to anticipate something that has not yet happened ‚Äì one must calibrate the model for it to capture only the ‚Äúessential‚Äù information that actually contributes to a good prediction, instead of fully capturing the patterns of that particular sample, because in doing so, useless information (‚Äú&lt;strong&gt;noise&lt;/strong&gt;‚Äù) is incorporated at the same time. Basically, by forcing a very accurate description of the sample data, we end up losing in generalization ability, since, in general, the future is &lt;strong&gt;not&lt;/strong&gt; a mere extension of the past.&lt;/p&gt;

&lt;p&gt;Models that describe the data of a sample excessively well tend to introduce a lot of complexity and volatility, thus hindering the generalization ability. In the philosophy of science there is a principle called &lt;strong&gt;Occam‚Äôs razor&lt;/strong&gt; (the statisticians know it as the ‚Äúprinciple of parsimony‚Äù, popular culture has adopted a rather pushy mnemonic:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;‚ÄúKISS ‚Äì &lt;strong&gt;keep it simple, stupid&lt;/strong&gt;‚Äú&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Basically, it means that between models with the same explanatory power, the simplest of them is the best, because it presents the same quality with a lower cost.&lt;/p&gt;

&lt;p&gt;By now, you should have realized that we indeed face a dilemma, as the ideal scenario demands two desirable but contradictory features: we want a model that describes well the available data &lt;strong&gt;AND&lt;/strong&gt; is capable of generalizing for future data. If we fit a model that misrepresents past data (‚Äúunder-fitting‚Äù), the model is kinda unreliable from the start. On the other hand, an over-adjustment (‚Äúover-fitting‚Äù) ends up assuming that the future will repeat the past, so the model tends to provide a poor prediction even for observations that follow just slightly different trends than the one showed in past data.&lt;/p&gt;

&lt;p&gt;The bias-variance dilemma is very important in the mathematical modelling: the quality of a model depends directly on the variables considered, and the optimal middle ground between incorporating useful variables and discarding useless variables can be quite a challenge. Let‚Äôs look at a simple example: Suppose that we want to construct a model to predict a company‚Äôs stock price. Is to be expected that the economic performance of that company influences decisively on the stock price, so we can put as variables some indicators like index of profitability and liquidity, the company‚Äôs market share, number of subsidiaries, and so on.&lt;/p&gt;

&lt;p&gt;For instance, we could put ‚ÄúCEO‚Äôs scholarity‚Äù as an explanatory variable; It is to be expected that a manager with a more robust academic background can increase the value of the company, but the relationship doesn‚Äôt seem that straightforward‚Ä¶ We could insert as a variable whether the CEO is right-handed, left-handed or ambidextrous, but this information tends not to influence the predicted variable at all, and the introduction of this variable would end up polluting the model with an &lt;strong&gt;unnecessary complexity&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Note that there‚Äôre no limits to the researcher‚Äôs creativity, and theoretically we could put a gigantic number of variables. But as less relevant variables are inserted, there comes a time when the ‚Äúvariance‚Äù introduced by the new variable does not compensate for the &lt;strong&gt;explanatory power&lt;/strong&gt; that it adds to the model.&lt;/p&gt;

&lt;p&gt;Knowing how to find the ideal middle ground between bias and variance is not an easy task, there are several techniques to aid us with this, such as cross-validation and dimensionality reduction, we can address these topics in future posts.&lt;/p&gt;
</content>
		</entry>
	

</feed>
