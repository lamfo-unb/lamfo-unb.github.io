<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Laboratório de Aprendizado de Máquina Aplicado a Finanças e Organizações">

    <title>Event Study - LAMFO</title>

    <link rel="canonical" href="http://localhost:4000/2017/08/17/Teste-de-Eventos-en/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="LAMFO" />

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://lamfo.unb.br">LAMFO</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
		<li>
                    <a href="https://lamfo-unb.github.io/about/">Sobre</a>
                </li>
		
		<!-- https://lamfo-unb.github.io/contact/-->
		
		<!--    
		 
		
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
				
                <li>
                    <a href="/contact/">Contact</a>
                </li>
				
                
				
                <li>
                    <a href="/data/">Data</a>
                </li>
				
                
				
                <li>
                    <a href="/projects/">Projects</a>
                </li>
				
                
		-->

            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/lamfo-unb.github.io/img/teste_eventos/wooden-table-texture_4460x4460.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Event Study</h1>
                    
                    <span class="meta">Posted by Ana Julia Akaishi Padula, Pedro Albuquerque on August 17, 2017</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1 id="event-study">Event Study</h1>

<p>Hello everyone! This week LAMFO brings to you the methodology known as Event Study, we will start with a breaf introduction, referencial and then an exemple using R.</p>

<p>Nowadays isn’t hard to hear or read news about events that change contries or the world. We receive updates, new information and opinions about different topics and we reflect it on our behavior and adjust our plans, but about the market? Do you think that it reacts about those event?</p>

<p>To answer this question was created the Event Study.</p>

<h2 id="methodology">Methodology</h2>

<p>The author Campbell, Lo and Mackinley (1997) were the firsts to define and write about this methodoly. The basic idea is to observe if the value of a company suffers a variation when a event appears, in other words, if the expected “normal return” if affected by an “annomaly”. The development of Event Study has it fundamentals on the Theory of Efficient Markets of Fama (1970), which believes that the markets absorbes the public information and reflects it in stocks prices.</p>

<p>Here are four simple steps to start an Event Study!</p>

<h3 id="step-1-define-the-event">Step 1: Define the Event</h3>

<p><em>But what kind of event are we talking about?</em></p>

<p>We can study any kind of event, we only need to have enough data and the event must be known by the public. As exemples of events we havey:</p>
<ol>
  <li>Dividends distribution;</li>
  <li>Fusion or aquisition of other company;</li>
  <li>Reaquisition of stocks;</li>
  <li>New laws or regulations;</li>
  <li>Privatization or nationalization;</li>
  <li>Political scandals.</li>
</ol>

<p>One the event has been chosen, a time line will be defined with the windows for analysis.</p>

<p><img src="https://i.imgur.com/QJzEnPH.png" alt="" /></p>

<p><strong>Estimation Window:</strong> this window stabilish the normal return expected from the company, from <script type="math/tex">T_0</script> to <script type="math/tex">T_1</script>. Here we will have a standart to compare the event, since this data hasn’t been “contaminated” by the news of the event.</p>

<p><strong>Event Window:</strong> here is the time where the news about the event get in. The zero moment (<script type="math/tex">0</script>) will be the exact date that the event came public, after that we stabilish a safaty window to be get the information leak before, from <script type="math/tex">T_1</script> to <script type="math/tex">0</script>, and to be sure that the market has absorbed all the information, from <script type="math/tex">2</script> to <script type="math/tex">T_2</script></p>

<p>An important detail, there is no fixed number to create the safety window. We can choose three months, fifthteen days or one year before the event, one way to identify the best safety window is testing different periods and analyse the statistic error.</p>

<p><strong>Pos Event Window</strong>: moment after the event and market position.</p>

<h3 id="step-2-companies">Step 2: Companies</h3>

<p>Once the dates are difined, now we need to select the companies that will be analysed and why. Usually, the first option is to get companies with stock exchange, since the returns are easy to get.</p>

<p>The second filter may be the sector or area that the companies are. For exemple, if we were studying the impact of new environmental law, would be interesting select companies from oil or mining industry.</p>

<p>Now we need to colect the return data from those companies. Is important that the data time format be the same, if the event will be marked by a day so the data of the returns must be daily returns.</p>

<h3 id="step-3-stabilish-normal-returns-and-abnormal">Step 3: Stabilish Normal Returns and Abnormal</h3>

<p>Following the time line, we first calculate the normal return of the stocks so then we can analyse the anormality.</p>

<p>A data base with the returns is enough to start the building the normal returns base. Remeber that the time format must be the same and they start at <script type="math/tex">T_0</script> and be over at <script type="math/tex">T_2</script>.</p>

<p>To verify the existence of abnormal returns, or not, we will use the equation:</p>

<script type="math/tex; mode=display">Ra_{i,t}=R_{i,t} - \mathbb E[R_i|X_t ]</script>

<table>
  <tbody>
    <tr>
      <td>Where <script type="math/tex">Ra_{i,t}</script> is the abnormal return, since it is the difference between the actual return in t(<script type="math/tex">R_{i,t}</script>) and the normal return ($$E[R_i</td>
      <td>X_t ]$$).</td>
    </tr>
  </tbody>
</table>

<p>Once we already had the base with companies return from <script type="math/tex">T_0</script> to <script type="math/tex">T_2</script>, we must choose the best model to stablish the standart return:</p>
<ol>
  <li>Constant Mean Return Model</li>
  <li>Adjusted Market Return</li>
  <li>Market Model</li>
  <li>Economic Model</li>
</ol>

<h4 id="constant-mean-return-model">Constant Mean Return Model</h4>
<p>The expected normal return is defined by a simple mean of the real return in the estimation window (<script type="math/tex">T_0</script> a <script type="math/tex">T_1</script>).</p>

<script type="math/tex; mode=display">Ra_{i,t}=R_{i,t} - \overline R_i</script>

<p>One critic to this model is that the assumption that the returns will be constants with the pass of time. In some time formats, where the volatility is high, this characteristic alrady has a problem.</p>

<h4 id="adjusted-market-return">Adjusted Market Return</h4>
<p>This case, the normal return will be difined by the return of the market portfolio (<script type="math/tex">Rm</script>). This method will require a new data base, in the same time format, from a benchmark.</p>

<script type="math/tex; mode=display">Ra_{i,t}=R_{i,t} -  Rm_i</script>

<h4 id="market-model">Market Model</h4>
<p>The Market Model has it base on statistic, representing an upgrade from the previous model.</p>

<p>Different from the Adjusted Market Return, the Market Model don’t set as default a market portfolio, but it uses an index such as S&amp;P500 for north-america analysis or IBOVESPA for Brazilian stocks, been defined by:</p>

<script type="math/tex; mode=display">Ra_{i,t}=R_{i,t} - \widehat \alpha_i - \widehat \beta_iR_{m,t}</script>

<p>The abnormal return (<script type="math/tex">Ra_{i,t}</script>) is defined by the difference from the real return of the asset in <strong><em>t</em></strong> and the parameters alpha (<script type="math/tex">\alpha</script>) and beta (<script type="math/tex">\beta</script>), estimated by a linear regression in the estimation window.</p>

<p>Using the linear regression in this model represent a big step in forecasting, since it depends on <script type="math/tex">R^2</script>. The bigger the <script type="math/tex">R^2</script>, less variance the abnormal return will have and more accurate the model will be.</p>

<h4 id="economic-models">Economic Models</h4>

<p>Based on the market actions and since our objective is to etimate the stock future return, there are two methodologies available: (1) Capital Asset Pricing Model (CAPM) and (2)Arbitrage Princing Theory (APT). Both of them may be used to the calculus of normal returns, but with their requisits.</p>

<ol>
  <li><em>Capital Asset Princing Model</em> (CAPM)</li>
</ol>

<script type="math/tex; mode=display">Ra_{i,t} = R_i - Rf_i - \beta (Rm_i - Rf_i)</script>

<p>The abnormal return is the result of the difference between the real return and the estipulated return, considering the sensibility of the asset and market retun (<script type="math/tex">Rm</script>) and free risk assets returns (<script type="math/tex">Rf</script>).</p>

<ol>
  <li><em>Arbitrage Pricing Theory</em> (APT)</li>
</ol>

<script type="math/tex; mode=display">Ra_{i,t} = R_i - R_f + \beta_1 R_1 + \beta_2 R_2 + \beta_n R_n</script>

<p>In this model, we have different risk prizes for different factos, each one with a specific sensibility, this mean that each factor has a beta. To aquire the betas (<script type="math/tex">\beta_n</script>) will be needed to do a linear regression for factor and asset.</p>

<h3 id="step-4-measuring-and-analyse-the-abnormal-returns">Step 4: Measuring and Analyse the Abnormal Returns</h3>

<p>When the model is set, we are ready to calculate the returns. Usually, we analyse the mean of abnormal return and the accumulative abnormal return.</p>

<p>To validate the results, look the P-VALOR of the model and the <script type="math/tex">R^2</script>. Both of them must be statistic relevant.</p>

<h3 id="applying-the-model">Applying the model</h3>

<p>This exercise will be done using R, the following packages are recommended:</p>
<ul>
  <li>quantmod : colect financial data from companies.</li>
  <li>eventstudies : automatic package to this methodology</li>
  <li>zoo : data base treatment.</li>
  <li>xts: treatment of temporal data without ajusts.</li>
</ul>

<h4 id="housing-bubble-in-usa-2008-effects-on-brazilian-companies">Housing Bubble in USA (2008) effects on Brazilian Companies</h4>

<p>We will use the package of Event Study already created in R and after compare the results with the manual estimation of event study. Once we are analysing an economic event in housing sector, we will look for companies with stocks listed in the market (BM&amp;FBOVESPA) and are in the sector. Since this is a simple exercise, we got two companies: Gafisa and Cyrela, and as a parameter for the Market Model the index IBOVESPA.</p>

<h3 id="event-study-using-the-package-eventstudies">Event Study using the package <em>eventstudies</em></h3>
<p>The package is divided in steps, the first one is stabilish the name and the date that the event occured. Since the event is the same for both of them, we will input “2008-03-13” that is the approximently the date that the event came public.</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1">#Step 1: List the assets and the date of the event
</span><span class="n">eventsDates</span><span class="o">&lt;-</span><span class="n">data.frame</span><span class="p">(</span><span class="s2">"name"</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"BVSP"</span><span class="p">,</span><span class="s2">"GAFISA"</span><span class="p">,</span><span class="s2">"CYRELA"</span><span class="p">),</span><span class="w">
                         </span><span class="s2">"when"</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"2008-03-13"</span><span class="p">,</span><span class="s2">"2008-03-13"</span><span class="p">,</span><span class="s2">"2008-03-13"</span><span class="p">))</span><span class="w">

</span><span class="c1">#Step 2: Convert the text
</span><span class="n">eventsDates</span><span class="o">$</span><span class="n">name</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">eventsDates</span><span class="o">$</span><span class="n">name</span><span class="p">)</span><span class="w">
</span><span class="n">eventsDates</span><span class="o">$</span><span class="n">when</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">eventsDates</span><span class="o">$</span><span class="n">when</span><span class="p">)</span><span class="w">

</span><span class="c1">#Step 3: Return Lists
</span><span class="n">BVSP</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"^BVSP.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">BVSP</span><span class="o">&lt;-</span><span class="n">BVSP</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">BVSP</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span><span class="s2">"BVSP"</span><span class="p">)</span><span class="w">

</span><span class="n">GAFISA</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"GFSA3.SA.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">GAFISA</span><span class="o">&lt;-</span><span class="n">GAFISA</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">GAFISA</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span><span class="s2">"GAFISA"</span><span class="p">)</span><span class="w">

</span><span class="n">CYRELA</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"CYRE3.SA.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">CYRELA</span><span class="o">&lt;-</span><span class="n">CYRELA</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">CYRELA</span><span class="p">)</span><span class="o">&lt;-</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Date"</span><span class="p">,</span><span class="s2">"CYRELA"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Step 4: Merge the data bases
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">BVSP</span><span class="p">,</span><span class="n">GAFISA</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s2">"Date"</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="o">&lt;-</span><span class="n">merge</span><span class="p">(</span><span class="n">dados</span><span class="p">,</span><span class="n">CYRELA</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s2">"Date"</span><span class="p">,</span><span class="n">all</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#Step 5: Calculate the return
</span><span class="n">data</span><span class="o">$</span><span class="n">BVSP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">BVSP</span><span class="p">)),</span><span class="w"> </span><span class="n">lag</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">GAFISA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">GAFISA</span><span class="p">)),</span><span class="w"> </span><span class="n">lag</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">CYRELA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">CYRELA</span><span class="p">)),</span><span class="w"> </span><span class="n">lag</span><span class="o">=</span><span class="m">1</span><span class="p">))</span><span class="w">

</span><span class="c1">#Step 6: Convert into zoo objects
</span><span class="n">data.zoo</span><span class="o">&lt;-</span><span class="n">read.zoo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">

</span><span class="c1">#Step 7: Event Study Market Model
</span><span class="n">es.mm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eventstudy</span><span class="p">(</span><span class="n">firm.returns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.zoo</span><span class="p">,</span><span class="w">    </span><span class="c1">#Returns base
</span><span class="w">                     </span><span class="n">event.list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventsDatas</span><span class="p">,</span><span class="w">  </span><span class="c1">#Event Dates
</span><span class="w">                     </span><span class="n">event.window</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w">          </span><span class="c1">#Safety Window size   
</span><span class="w">                     </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"marketModel"</span><span class="p">,</span><span class="w">      </span><span class="c1">#Abnormal return model
</span><span class="w">                     </span><span class="n">to.remap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">           </span><span class="c1">#Recalculate the return using cumsum
</span><span class="w">                     </span><span class="n">remap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cumsum"</span><span class="p">,</span><span class="w">          </span><span class="c1">#Accumulative return
</span><span class="w">                     </span><span class="n">inference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">          </span><span class="c1">#Inference of the event
</span><span class="w">                     </span><span class="n">inference.strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bootstrap"</span><span class="p">,</span><span class="w">   </span><span class="c1">#Boostrap to standert error
</span><span class="w">                     </span><span class="n">model.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">market.returns</span><span class="o">=</span><span class="n">dados</span><span class="o">$</span><span class="n">BVSP</span><span class="p">))</span><span class="w">  </span><span class="c1">#Data base with the index IBOVESPA
#Step 8: Plot event study
</span><span class="n">plot</span><span class="p">(</span><span class="n">es.mm</span><span class="p">)</span><span class="w">

</span><span class="c1">#Step 9: Results
</span><span class="n">summary</span><span class="p">(</span><span class="n">es.mm</span><span class="p">)</span><span class="w">

</span></code></pre>
</div>
<p>As results we have:</p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">Event</span><span class="w"> </span><span class="n">outcome</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">outcomes</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="n">events</span><span class="o">:</span><span class="w"> 
</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="s2">"success"</span><span class="w"> </span><span class="s2">"success"</span><span class="w"> </span><span class="s2">"success"</span><span class="w">
</span></code></pre>
</div>

<p>Aparently the bubble in USA has effected the return in Brazilian companies, but the result is significant? Let’s look into the graphic:</p>

<p><img src="/img/teste_eventos/GAFISA+CYRELA.png" alt="" /></p>

<p>The blue line represent the companies’ return, and since is inside the abnormal area (doted lines) it shows the anormality of the series. However, the five days windw presents results equal zero, this mean that even if the event appears to cause disturbance in the series, it isn’t statistic significant.</p>

<p>Now, let’s calculate withou the package!</p>

<h3 id="event-study-by-hand">Event Study by hand</h3>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="n">ls</span><span class="p">())</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">quantmod</span><span class="p">)</span><span class="w">
</span><span class="n">GFSA</span><span class="o">&lt;-</span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"GFSA3.SA.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">CYRE</span><span class="o">&lt;-</span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"CYRE3.SA.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">BVSP</span><span class="o">&lt;-</span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"^BVSP.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Convert the date
</span><span class="n">GFSA</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">GFSA</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">GFSA</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">GFSA</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span><span class="w">
</span><span class="n">GFSA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xts</span><span class="p">(</span><span class="n">GFSA</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="n">order.by</span><span class="o">=</span><span class="n">GFSA</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="n">CYRE</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">CYRE</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">CYRE</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">CYRE</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span><span class="w">
</span><span class="n">CYRE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xts</span><span class="p">(</span><span class="n">CYRE</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="n">order.by</span><span class="o">=</span><span class="n">CYRE</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="n">BVSP</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="nf">as.character</span><span class="p">(</span><span class="n">BVSP</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">BVSP</span><span class="o">$</span><span class="n">Date</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="n">BVSP</span><span class="o">$</span><span class="n">Date</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"%Y-%m-%d"</span><span class="p">)</span><span class="w">
</span><span class="n">BVSP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xts</span><span class="p">(</span><span class="n">BVSP</span><span class="p">[,</span><span class="m">-1</span><span class="p">],</span><span class="w"> </span><span class="n">order.by</span><span class="o">=</span><span class="n">BVSP</span><span class="p">[,</span><span class="m">1</span><span class="p">])</span><span class="w">

</span><span class="c1">#Bubble in 2008
</span><span class="n">startEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2008-03-13"</span><span class="p">)</span><span class="w"> 

</span><span class="c1">#Stabilish the window
</span><span class="n">endEvent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2008-03-18"</span><span class="p">)</span><span class="w"> 

</span><span class="c1">#Start of the series
</span><span class="n">startDate</span><span class="o">&lt;-</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"2008-01-01"</span><span class="p">)</span><span class="w">

</span><span class="c1">#Calculate the log-retorn.
</span><span class="n">diffGFSA</span><span class="o">&lt;-</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">GFSA</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">))</span><span class="w">
</span><span class="n">diffCYRE</span><span class="o">&lt;-</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">CYRE</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">))</span><span class="w">

</span><span class="c1">#Plot the adjusted close series
</span><span class="n">plot.xts</span><span class="p">(</span><span class="n">diffGFSA</span><span class="p">,</span><span class="n">major.format</span><span class="o">=</span><span class="s2">"%b/%d/%Y"</span><span class="p">,</span><span class="w">
         </span><span class="n">main</span><span class="o">=</span><span class="s2">"GAFISA"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Log-return Adj.Close price."</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Time"</span><span class="p">)</span><span class="w">

</span><span class="n">plot.xts</span><span class="p">(</span><span class="n">diffCYRE</span><span class="p">,</span><span class="n">major.format</span><span class="o">=</span><span class="s2">"%b/%d/%Y"</span><span class="p">,</span><span class="w">
         </span><span class="n">main</span><span class="o">=</span><span class="s2">"CYRELA"</span><span class="p">,</span><span class="n">ylab</span><span class="o">=</span><span class="s2">"Log-return Adj.Close price."</span><span class="p">,</span><span class="n">xlab</span><span class="o">=</span><span class="s2">"Time"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p><img src="/img/teste_eventos/ações ajustadas GAFISA.png" alt="" />
<img src="/img/teste_eventos/ações ajustadas cyrela.png" alt="" /></p>

<div class="language-R highlighter-rouge"><pre class="highlight"><code><span class="c1">#Estimation Window
</span><span class="n">GFSASubset</span><span class="o">&lt;-</span><span class="w">  </span><span class="n">window</span><span class="p">(</span><span class="n">diffGFSA</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="m">-1</span><span class="p">)</span><span class="w">
</span><span class="n">CYRESubset</span><span class="o">&lt;-</span><span class="w">  </span><span class="n">window</span><span class="p">(</span><span class="n">diffCYRE</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="m">-1</span><span class="p">)</span><span class="w">

</span><span class="c1">#BVSP
</span><span class="n">diffBVSP</span><span class="o">&lt;-</span><span class="n">diff</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">BVSP</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">))</span><span class="w">
</span><span class="n">BVSPSubset</span><span class="o">&lt;-</span><span class="n">window</span><span class="p">(</span><span class="n">diffBVSP</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDate</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="m">-1</span><span class="p">)</span><span class="w">

</span><span class="c1">#Market Model
</span><span class="n">MarketModel</span><span class="o">&lt;-</span><span class="n">lm</span><span class="p">(</span><span class="n">GFSASubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="o">~</span><span class="n">BVSPSubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">MarketModel</span><span class="p">)</span><span class="w">

</span><span class="n">MarketModel2</span><span class="o">&lt;-</span><span class="n">lm</span><span class="p">(</span><span class="n">CYRESubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="o">~</span><span class="n">BVSPSubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">MarketModel2</span><span class="p">)</span><span class="w">

</span><span class="c1">#Using Market Model
</span><span class="n">epsilon</span><span class="o">&lt;-</span><span class="n">diffGFSA</span><span class="o">-</span><span class="n">coef</span><span class="p">(</span><span class="n">MarketModel</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">coef</span><span class="p">(</span><span class="n">MarketModel</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="n">diffBVSP</span><span class="w">

</span><span class="n">epsilon2</span><span class="o">&lt;-</span><span class="n">diffCYRE</span><span class="o">-</span><span class="n">coef</span><span class="p">(</span><span class="n">MarketModel2</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">coef</span><span class="p">(</span><span class="n">MarketModel2</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="n">diffBVSP</span><span class="w">

</span><span class="c1">#Find epsilon's variance
</span><span class="n">BVSPSubset1</span><span class="o">&lt;-</span><span class="n">na.omit</span><span class="p">(</span><span class="n">window</span><span class="p">(</span><span class="n">diffBVSP</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startDate</span><span class="m">+1</span><span class="p">,</span><span class="w">
                           </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="m">-1</span><span class="p">))</span><span class="w">

</span><span class="n">X</span><span class="o">&lt;-</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">BVSPSubset1</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)),</span><span class="n">BVSPSubset1</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">))</span><span class="w">

</span><span class="n">BVSPSubset2</span><span class="o">&lt;-</span><span class="n">window</span><span class="p">(</span><span class="n">diffBVSP</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endEvent</span><span class="p">)</span><span class="w">

</span><span class="n">Xstar</span><span class="o">&lt;-</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">BVSPSubset2</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)),</span><span class="n">BVSPSubset2</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">))</span><span class="w">

</span><span class="c1">#GAFISA calculus
</span><span class="n">V</span><span class="o">&lt;-</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">var</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">MarketModel</span><span class="p">)))</span><span class="o">+</span><span class="w">
  </span><span class="p">((</span><span class="n">X</span><span class="o">%*%</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">Xstar</span><span class="p">)</span><span class="o">%*%</span><span class="n">Xstar</span><span class="p">)</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">var</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">MarketModel</span><span class="p">)))</span><span class="w">

</span><span class="n">epsilonStar</span><span class="o">&lt;-</span><span class="n">window</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endEvent</span><span class="p">)</span><span class="w">
</span><span class="n">CAR</span><span class="o">&lt;-</span><span class="nf">sum</span><span class="p">(</span><span class="n">epsilonStar</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="w">
</span><span class="n">SCAR</span><span class="o">&lt;-</span><span class="n">CAR</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">V</span><span class="p">))</span><span class="w">

</span><span class="c1">#CYRELA calculus
</span><span class="n">V</span><span class="m">2</span><span class="o">&lt;-</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">var</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">MarketModel2</span><span class="p">)))</span><span class="o">+</span><span class="w">
  </span><span class="p">((</span><span class="n">X</span><span class="o">%*%</span><span class="n">solve</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">Xstar</span><span class="p">)</span><span class="o">%*%</span><span class="n">Xstar</span><span class="p">)</span><span class="o">%*%</span><span class="n">t</span><span class="p">(</span><span class="n">X</span><span class="p">))</span><span class="o">*</span><span class="n">var</span><span class="p">(</span><span class="n">residuals</span><span class="p">(</span><span class="n">MarketModel2</span><span class="p">)))</span><span class="w">

</span><span class="n">epsilonStar2</span><span class="o">&lt;-</span><span class="n">window</span><span class="p">(</span><span class="n">epsilon2</span><span class="p">,</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">startEvent</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endEvent</span><span class="p">)</span><span class="w">
</span><span class="n">CAR2</span><span class="o">&lt;-</span><span class="nf">sum</span><span class="p">(</span><span class="n">epsilonStar2</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="w">
</span><span class="n">SCAR2</span><span class="o">&lt;-</span><span class="n">CAR2</span><span class="o">/</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="n">V</span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="c1">#Critical value of T distribution
</span><span class="n">alpha</span><span class="o">&lt;</span><span class="m">-0.05</span><span class="w">
</span><span class="n">df</span><span class="o">&lt;-</span><span class="nf">length</span><span class="p">(</span><span class="n">GFSASubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="m">-2</span><span class="w">
</span><span class="n">qt</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">qt</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="m">2</span><span class="p">),</span><span class="n">df</span><span class="p">)</span><span class="w">

</span><span class="n">df2</span><span class="o">&lt;-</span><span class="nf">length</span><span class="p">(</span><span class="n">CYRESubset</span><span class="o">$</span><span class="n">Adj.Close</span><span class="p">)</span><span class="m">-2</span><span class="w">
</span><span class="n">qt</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="m">2</span><span class="p">,</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">qt</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="m">2</span><span class="p">),</span><span class="n">df</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<p>The results for both companies are -2.012896 e 2.012896. Since wasn’t found any evidence in favor to reject the null hypothesis, the event has no significant impact over the compnies.</p>

<p>Finished this quick exercise about event study, in case of any doubt or for more info contact the LAMFO team!</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2017/08/17/Teste-de-Eventos/" data-toggle="tooltip" data-placement="top" title="Teste de Eventos">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2017/08/17/Modelos-Compostos/" data-toggle="tooltip" data-placement="top" title="Modelos Regressivos Compostos para Estimativas de Preço">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>
<div id="disqusbox">
    <div id="disqus_thread" width=500px></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = 'https://lamfo.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>
<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/lamfounb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/lamfo-unb">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="mailto:lamfo@unb.br">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; LAMFO - UNB 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-97417743-1', 'auto');
  ga('send', 'pageview');

</script>



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML,Safe"></script>

</body>

</html>
